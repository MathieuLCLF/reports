SELECT 
    u.city AS 'City',
    c.shortname AS 'Course',
    u.firstname AS 'Firstname',
    u.lastname AS 'Lastname',
    FROM_UNIXTIME(lrs.timestamp, '%M %D %Y') AS 'Completed',
    FROM_UNIXTIME(lrs.expires, '%M %D %Y') AS 'Expires_On'
FROM
    view_prefix_lrs_simple lrs
        JOIN
    prefix_user u ON u.id = lrs.userid
        JOIN
    prefix_course c ON c.id = lrs.objectid
        AND lrs.objecttype = 'course'
WHERE
    lrs.expires > (UNIX_TIMESTAMP() - (90 * 86400))
        AND u.deleted = 0
        AND u.suspended = 0
ORDER BY u.city , c.shortname , u.firstname , u.lastname
